from urllib.parse import urlparse, parse_qs

def analyze_sql_injection_risk(target: str, recon: dict, directories: list):
    risks = []

    parsed = urlparse(target)
    params = parse_qs(parsed.query)

    # 1. URL parameters present
    if params:
        risks.append({
            "type": "sql_injection_risk",
            "reason": "URL contains query parameters that may be dynamically used in database queries",
            "confidence": "medium"
        })

    # 2. Admin / login paths discovered
    sensitive_paths = ["login", "admin", "account", "user"]
    if any(p in "/".join(directories).lower() for p in sensitive_paths):
        risks.append({
            "type": "sql_injection_risk",
            "reason": "Authentication-related paths increase SQL injection attack surface",
            "confidence": "high"
        })

    # 3. Server fingerprint correlation
    server = recon.get("data", {}).get("http_headers", {}).get("server", "").lower()
    if "php" in server or "apache" in server:
        risks.append({
            "type": "sql_injection_risk",
            "reason": "Legacy backend stacks historically vulnerable to SQL injection if input is unsanitized",
            "confidence": "medium"
        })

    return risks
