from backend.vulnerability_assessment.schema import base_va_schema
from backend.vulnerability_assessment.attack_surface import infer_attack_surface
from backend.vulnerability_assessment.cve_lookup import lookup_cves

class VulnerabilityAssessmentEngine:
    def __init__(self, recon_result: dict):
        self.recon = recon_result

    def run(self):
        va_result = base_va_schema(self.recon["meta"]["target"])

        attack_surface = infer_attack_surface(self.recon["data"])
        cves = lookup_cves(attack_surface)

        for cve in cves:
            va_result["findings"].append({
                "type": "cve",
                "id": cve["cve"],
                "description": cve["description"],
                "severity": cve["severity"]
            })

        return va_result
